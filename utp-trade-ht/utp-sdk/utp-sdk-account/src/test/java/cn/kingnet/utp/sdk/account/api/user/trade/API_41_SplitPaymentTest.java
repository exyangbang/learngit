package cn.kingnet.utp.sdk.account.api.user.trade;

import cn.kingnet.utp.sdk.account.AccountClient;
import cn.kingnet.utp.sdk.account.api.UtpAccountTestCase;
import cn.kingnet.utp.sdk.account.dto.SplitPaymentReqDTO;
import cn.kingnet.utp.sdk.account.dto.SplitPaymentRespDTO;
import cn.kingnet.utp.sdk.core.dto.ServerResponse;
import cn.kingnet.utp.sdk.core.enums.AuthType;
import cn.kingnet.utp.sdk.core.enums.HttpRespStatus;
import com.alibaba.fastjson.JSON;
import lombok.extern.slf4j.Slf4j;
import org.junit.Test;

import java.time.LocalDate;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.ExecutionException;
import java.util.concurrent.TimeUnit;
import java.util.concurrent.TimeoutException;
import java.util.concurrent.atomic.AtomicInteger;
import java.util.stream.IntStream;

/**
 * @Description 单笔实时分账
 * @Author WJH
 * @Date 2020/03/14
 */
@Slf4j
public class API_41_SplitPaymentTest extends UtpAccountTestCase {
    @Test
    public void test() {
        try {
            AccountClient client = new AccountClient(createAuthorization(AuthType.HTSIGN), host);
            AccountClient.Builder<SplitPaymentRespDTO> builder = client.newSplitPaymentBuilder();
            // 初始化requestBody
            SplitPaymentReqDTO reqDTO = new SplitPaymentReqDTO();
            reqDTO.setClientTradeId(mockClientTransId());
            reqDTO.setReqDate(LocalDate.now().format(DateTimeFormatter.ofPattern("yyyyMMdd")));
            reqDTO.setReqTime(LocalTime.now().format(DateTimeFormatter.ofPattern("HHmmss")));

            String tradeOrderIds = "1231232132132132132131,1287668514165743617,1287668514165743618,1287668514165743619,1287668514165743620,1287668514165743621,1287668514165743622,1287668514165743623,1287668514165743624,1287668514165743625,1287668514165743626,1287668514165743627,1287668514165743628,1287668514165743629,1287668514165743630,1287668514165743631,1287668514165743632,1287668514165743633,1287668514165743634,1287668514165743635,1287668514299961345,1287668514299961346,1287668514299961347,1287668514299961348,1287668514299961349,1287668514299961350,1287668514299961351,1287668514299961352,1287668514299961353,1287668514299961354,1287668514299961355,1287668514299961356,1287668514299961357,1287668514299961358,1287668514299961359,1287668514299961360,1287668514299961361,1287668514299961362,1287668514299961363,1287668514299961364,1287668514299961365,1287668514299961366,1287668514299961367,1287668514299961368,1287668514299961369,1287668514299961370,1287668514299961371,1287668514299961372,1287668514299961373,1287668514299961374,1287668514299961375,1287668514299961376,1287668514299961377,1287668514299961378,1287668514299961379,1287668514299961380,1287668514299961381,1287668514299961382,1287668514299961383,1287668514299961384,1287668514299961385,1287668514299961386,1287668514299961387,1287668514299961388,1287668514299961389,1287668514299961390,1287668514299961391,1287668514299961392,1287668514299961393,1287668514299961394,1287668514299961395,1287668514299961396,1287668514299961397,1287668514299961398,1287668514299961399,1287668514299961400,1287668514299961401,1287668514299961402,1287668514299961403,1287668514299961404,1287668514299961405,1287668514299961406,1287668514299961407,1287668514299961408,1287668514299961409,1287668514299961410,1287668514299961411,1287668514299961412,1287668514299961413,1287668514299961414,1287668514299961415,1287668514299961416,1287668514299961417,1287668514299961418,1287668514299961419,1287668514362875906,1287668514362875907,1287668514362875908,1287668514362875909,1287668514362875910,1287668514362875911,1287668514362875912,1287668514362875913,1287668514362875914,1287668514362875915,1287668514362875916,1287668514362875917,1287668514362875918,1287668514362875919,1287668514362875920,1287668514362875921,1287668514362875922,1287668514362875923,1287668514362875924,1287668514429984769,1287668514429984770,1287668514429984771,1287668514429984772,1287668514429984773,1287668514429984774,1287668514429984775,1287668514429984776,1287668514429984777,1287668514429984778,1287668514429984779,1287668514429984780,1287668514429984781,1287668514429984782,1287668514429984783,1287668514429984784,1287668514429984785,1287668514429984786,1287668514429984787,1287668514429984788,1287668514429984789,1287668514429984790,1287668514429984791,1287668514429984792,1287668514429984793,1287668514429984794,1287668514429984795,1287668514429984796,1287668514429984797,1287668514429984798,1287668514429984799,1287668514429984800,1287668514429984801,1287668514429984802,1287668514429984803,1287668514429984804,1287668514429984805,1287668514429984806,1287668514429984807,1287668514429984808,1287668514429984809,1287668514429984810,1287668514429984811,1287668514429984812,1287668514429984813,1287668514429984814,1287668514429984815,1287668514429984816,1287668514429984817,1287668514429984818,1287668514429984819,1287668514429984820,1287668514429984821,1287668514429984822,1287668514429984823,1287668514429984824,1287668514429984825,1287668514429984826,1287668514429984827,1287668514429984828,1287668514429984829,1287668514429984830,1287668514497093634,1287668514497093635,1287668514497093636,1287668514497093637,1287668514497093638,1287668514497093639,1287668514497093640,1287668514497093641,1287668514497093642,1287668514497093643,1287668514497093644,1287668514497093645,1287668514497093646,1287668514497093647,1287668514497093648,1287668514497093649,1287668514497093650,1287668514497093651,1287668514497093652,1287668514497093653,1287668514497093654,1287668514497093655,1287668514497093656,1287668514497093657,1287668514497093658,1287668514497093659,1287668514497093660,1287668514497093661,1287668514497093662,1287668514497093663,1287668514497093664,1287668514497093665,1287668514497093666,1287668514497093667,1287668514497093668,1287668514497093669,1287668514497093670,1287668514497093671,1287668514497093672,1287668514497093673,1287668514497093674,1287668514497093675,1287668514497093676,1287668514497093677,1287668514497093678,1287668514497093679,1287668514497093680,1287668514497093681,1287668514497093682,1287668514497093683,1287668514497093684,1287668514497093685,1287668514497093686,1287668514497093687,1287668514497093688,1287668514497093689,1287668514497093690,1287668514497093691,1287668514497093692,1287668514497093693,1287668514497093694,1287668514497093695,1287668514497093696,1287668514497093697,1287668514497093698,1287668514497093699,1287668514497093700,1287668514497093701,1287668514497093702,1287668514497093703,1287668514497093704,1287668514497093705,1287668514497093706,1287668514497093707,1287668514497093708,1287668514497093709,1287668514497093710,1287668514497093711,1287668514497093712,1287668514497093713,1287668514497093714,1287668514497093715,1287668514497093716,1287668514497093717,1287668514497093718,1287668514497093719,1287668514497093720,1287668514497093721,1287668514497093722,1287668514497093723,1287668514497093724,1287668514497093725,1287668514497093726,1287668514497093727,1287668514497093728,1287668514497093729,1287668514497093730,1287668514497093731,1287668514497093732,1287668514497093733,1287668514560008193,1287668514560008194,1287668514560008195,1287668514560008196,1287668514560008197,1287668514560008198,1287668514560008199,1287668514560008200,1287668514560008201,1287668514560008202,1287668514560008203,1287668514560008204,1287668514560008205,1287668514560008206,1287668514560008207,1287668514560008208,1287668514560008209,1287668514560008210,1287668514560008211,1287668514560008212,1287668514560008213,1287668514560008214,1287668514560008215,1287668514560008216,1287668514560008217,1287668514560008218,1287668514560008219,1287668514560008220,1287668514560008221,1287668514560008222,1287668514560008223,1287668514560008224,1287668514560008225,1287668514560008226,1287668514560008227,1287668514560008228,1287668514560008229,1287668514560008230,1287668514560008231,1287668514560008232,1287668514560008233,1287668514560008234,1287668514560008235,1287668514560008236,1287668514560008237,1287668514560008238,1287668514560008239,1287668514560008240,1287668514560008241,1287668514560008242,1287668514560008243,1287668514560008244,1287668514560008245,1287668514560008246,1287668514560008247,1287668514560008248,1287668514560008249,1287668514560008250,1287668514560008251,1287668514560008252,1287668514560008253,1287668514560008254,1287668514560008255,1287668514560008256,1287668514560008257,1287668514560008258,1287668514560008259,1287668514560008260,1287668514560008261,1287668514560008262,1287668514560008263,1287668514560008264,1287668514560008265,1287668514560008266,1287668514560008267,1287668514560008268,1287668514560008269,1287668514560008270,1287668514560008271,1287668514560008272,1287668514627117058,1287668514690031617,1287668514690031618,1287668514690031619,1287668514690031620,1287668514690031621,1287668514690031622,1287668514690031623,1287668514690031624,1287668514690031625,1287668514690031626,1287668514690031627,1287668514690031628,1287668514690031629,1287668514690031630,1287668514690031631,1287668514690031632,1287668514690031633,1287668514690031634,1287668514690031635,1287668514690031636,1287668514690031637,1287668514690031638,1287668514690031639,1287668514690031640,1287668514757140482,1287668514757140483,1287668514757140484,1287668514757140485,1287668514757140486,1287668514757140487,1287668514757140488,1287668514757140489,1287668514757140490,1287668514757140491,1287668514757140492,1287668514757140493,1287668514757140494,1287668514757140495,1287668514757140496,1287668514757140497,1287668514757140498,1287668514757140499,1287668514757140500,1287668514757140501,1287668514757140502,1287668514757140503,1287668514757140504,1287668514757140505,1287668514757140506,1287668514757140507,1287668514757140508,1287668514757140509,1287668514757140510,1287668514757140511,1287668514757140512,1287668514757140513,1287668514757140514,1287668514757140515,1287668514757140516,1287668514757140517,1287668514786500610,1287668514786500611,1287668514786500612,1287668514786500613,1287668514786500614,1287668514786500615,1287668514786500616,1287668514790694914,1287668514790694915,1287668514790694916,1287668514790694917,1287668514790694918,1287668514790694919,1287668514790694920,1287668514790694921,1287668514790694922,1287668514790694923,1287668514790694924,1287668514790694925,1287668514790694926,1287668514790694927,1287668514790694928,1287668514790694929,1287668514790694930,1287668514790694931,1287668514790694932,1287668514790694933,1287668514790694934,1287668514790694935,1287668514790694936,1287668514790694937,1287668514790694938,1287668514790694939,1287668514799083521,1287668514799083522,1287668514799083523,1287668514799083524,1287668514799083525,1287668514799083526,1287668514799083527,1287668514799083528,1287668514799083529,1287668514799083530,1287668514799083531,1287668514799083532,1287668514799083533,1287668514799083534,1287668514799083535,1287668514799083536,1287668514799083537,1287668514799083538,1287668514799083539,1287668514799083540,1287668514799083541,1287668514799083542,1287668514799083543,1287668514799083544,1287668514799083545,1287668514799083546,1287668514799083547,1287668514799083548,1287668514799083549,1287668514799083550,1287668514799083551,1287668514799083552,1287668514799083553,1287668514799083554,1287668514807472129,1287668514807472130,1287668514807472131,1287668514807472132,1287668514807472133,1287668514807472134,1287668514807472135,1287668514807472136,1287668514807472137,1287668514807472138,1287668514807472139,1287668514807472140,1287668514807472141,1287668514807472142,1287668514807472143,1287668514807472144,1287668514807472145,1287668514807472146,1287668514807472147,1287668514807472148,1287668514807472149,1287668514807472150,1287668514807472151,1287668514807472152,1287668514807472153,1287668514807472154,1287668514807472155,1287668514807472156,1287668514807472157,1287668514807472158,1287668514807472159,1287668514807472160,1287668514807472161,1287668514807472162,1287668514807472163,1287668514807472164,1287668514807472165,1287668514807472166,1287668514807472167,1287668514807472168,1287668514807472169,1287668514807472170,1287668514807472171,1287668514807472172,1287668514807472173,1287668514807472174,1287668514807472175,1287668514807472176,1287668514807472177,1287668514807472178,1287668514807472179,1287668514807472180,1287668514807472181,1287668514807472182,1287668514807472183,1287668514807472184,1287668514807472185,1287668514807472186,1287668514807472187,1287668514807472188,1287668514807472189,1287668514807472190,1287668514807472191,1287668514807472192,1287668514807472193,1287668514807472194,1287668514807472195,1287668514807472196,1287668514807472197,1287668514807472198,1287668514807472199,1287668514807472200,1287668514807472201,1287668514807472202,1287668514807472203,1287668514807472204,1287668514807472205,1287668514807472206,1287668514807472207,1287668514807472208,1287668514807472209,1287668514807472210,1287668514807472211,1287668514807472212,1287668514807472213,1287668514807472214,1287668514807472215,1287668514807472216,1287668514807472217,1287668514807472218,1287668514807472219,1287668514807472220,1287668514807472221,1287668514807472222,1287668514807472223,1287668514807472224,1287668514807472225,1287668514807472226,1287668514807472227,1287668514807472228,1287668514807472229,1287668514807472230,1287668514807472231,1287668514807472232,1287668514807472233,1287668514807472234,1287668514807472235,1287668514807472236,1287668514807472237,1287668514807472238,1287668514857803778,1287668514857803779,1287668514857803780,1287668514857803781,1287668514857803782,1287668514857803783,1287668514857803784,1287668514857803785,1287668514857803786,1287668514857803787,1287668514857803788,1287668514857803789,1287668514857803790,1287668514857803791,1287668514857803792,1287668514857803793,1287668514857803794,1287668514857803795,1287668514857803796,1287668514857803797,1287668514857803798,1287668514857803799,1287668514857803800,1287668514857803801,1287668514866192385,1287668514866192386,1287668514866192387,1287668514866192388,1287668514866192389,1287668514866192390,1287668514866192391,1287668514866192392,1287668514866192393,1287668514866192394,1287668514866192395,1287668514866192396,1287668514866192397,1287668514866192398,1287668514866192399,1287668514866192400,1287668514866192401,1287668514866192402,1287668514866192403,1287668514866192404,1287668514866192405,1287668514866192406,1287668514866192407,1287668514866192408,1287668514866192409,1287668514866192410,1287668514866192411,1287668514866192412,1287668514866192413,1287668514866192414,1287668514866192415,1287668514866192416,1287668514866192417,1287668514866192418,1287668514866192419,1287668514866192420,1287668514866192421,1287668514866192422,1287668514866192423,1287668514866192424,1287668514866192425,1287668514866192426,1287668514866192427,1287668514866192428,1287668514866192429,1287668514866192430,1287668514866192431,1287668514866192432,1287668514866192433,1287668514866192434,1287668514866192435,1287668514866192436,1287668514866192437,1287668514866192438,1287668514866192439,1287668514866192440,1287668514866192441,1287668514866192442,1287668514866192443,1287668514866192444,1287668514866192445,1287668514866192446,1287668514866192447,1287668514866192448,1287668514866192449,1287668514866192450,1287668514866192451,1287668514866192452,1287668514866192453,1287668514866192454,1287668514866192455,1287668514866192456,1287668514866192457,1287668514866192458,1287668514866192459,1287668514866192460,1287668514866192461,1287668514866192462,1287668514866192463,1287668514866192464,1287668514866192465,1287668514866192466,1287668514866192467,1287668514866192468,1287668514866192469,1287668514866192470,1287668514866192471,1287668514866192472,1287668514866192473,1287668514866192474,1287668514866192475,1287668514866192476,1287668514866192477,1287668514866192478,1287668514866192479,1287668514866192480,1287668514866192481,1287668514866192482,1287668514866192483,1287668514866192484,1287668514866192485,1287668514866192486,1287668514866192487,1287668514866192488,1287668514866192489,1287668514866192490,1287668514866192491,1287668514866192492,1287668514866192493,1287668514866192494,1287668514866192495,1287668514866192496,1287668514866192497,1287668514866192498,1287668514866192499,1287668514866192500,1287668514866192501,1287668514866192502,1287668514866192503,1287668514866192504,1287668514895552513,1287668514895552514,1287668514895552515,1287668514895552516,1287668514895552517,1287668514895552518,1287668514895552519,1287668514895552520,1287668514895552521,1287668514895552522,1287668514895552523,1287668514895552524,1287668514895552525,1287668514920718337,1287668514920718338,1287668514920718339,1287668514920718340,1287668514920718341,1287668514920718342,1287668514920718343,1287668514920718344,1287668514920718345,1287668514920718346,1287668514920718347,1287668514920718348,1287668514920718349,1287668514920718350,1287668514920718351,1287668514920718352,1287668514920718353,1287668514920718354,1287668514933301250,1287668514933301251,1287668514933301252,1287668514933301253,1287668514933301254,1287668514933301255,1287668514933301256,1287668514933301257,1287668514933301258,1287668514933301259,1287668514933301260,1287668514933301261,1287668514933301262,1287668514933301263,1287668514933301264,1287668514933301265,1287668514941689858,1287668514941689859,1287668514941689860,1287668514941689861,1287668514941689862,1287668514941689863,1287668514941689864,1287668514941689865,1287668514941689866,1287668514941689867,1287668514941689868,1287668514941689869,1287668514941689870,1287668514941689871,1287668514941689872,1287668514941689873,1287668514941689874,1287668514941689875,1287668514941689876,1287668514941689877,1287668514941689878,1287668514941689879,1287668514941689880,1287668514941689881,1287668514941689882,1287668514941689883,1287668514941689884,1287668514941689885,1287668514941689886,1287668514941689887,1287668514941689888,1287668514941689889,1287668514941689890,1287668514941689891,1287668514941689892,1287668514941689893,1287668514941689894,1287668514941689895,1287668514941689896,1287668514941689897,1287668514941689898,1287668514941689899,1287668514941689900,1287668514950078466,1287668514950078467,1287668514950078468,1287668514950078469,1287668514950078470,1287668514950078471,1287668514950078472,1287668514950078473,1287668514950078474,1287668514950078475,1287668514950078476,1287668514950078477,1287668514950078478,1287668514950078479,1287668514950078480,1287668514950078481,1287668514950078482,1287668514950078483,1287668514950078484,1287668514950078485,1287668514950078486,1287668514950078487,1287668514950078488,1287668514950078489,1287668514950078490,1287668514950078491,1287668514950078492,1287668514950078493,1287668514950078494,1287668514950078495,1287668514950078496,1287668514950078497,1287668514950078498,1287668514950078499,1287668514950078500,1287668514950078501,1287668514950078502,1287668514950078503,1287668514950078504,1287668514950078505,1287668514950078506,1287668514958467073,1287668514958467074,1287668514958467075,1287668514958467076,1287668514966855682,1287668514971049985,1287668514971049986,1287668514971049987,1287668514971049988,1287668514971049989,1287668514971049990,1287668514987827202,1287668514987827203,1287668514987827204,1287668514987827205,1287668514987827206,1287668514987827207,1287668514987827208,1287668514987827209,1287668514987827210,1287668514987827211,1287668514987827212,1287668514987827213,1287668514987827214,1287668514987827215,1287668514987827216,1287668514987827217,1287668514996215809,1287668514996215810,1287668514996215811,1287668514996215812,1287668514996215813,1287668514996215814,1287668514996215815,1287668514996215816,1287668514996215817,1287668514996215818,1287668514996215819,1287668515004604418,1287668515004604419,1287668515004604420,1287668515004604421,1287668515004604422,1287668515004604423,1287668515004604424,1287668515004604425,1287668515004604426,1287668515004604427,1287668515004604428,1287668515004604429,1287668515004604430,1287668515004604431,1287668515004604432,1287668515004604433,1287668515004604434,1287668515004604435,1287668515004604436,1287668515004604437,1287668515004604438,1287668515004604439,1287668515004604440,1287668515004604441,1287668515004604442,1287668515004604443,1287668515004604444,1287668515004604445,1287668515004604446,1287668515004604447,1287668515004604448,1287668515004604449,1287668515004604450,1287668515012993026,1287668515012993027,1287668515012993028,1287668515012993029,1287668515012993030,1287668515012993031,1287668515012993032,1287668515012993033,1287668515012993034,1287668515012993035,1287668515012993036,1287668515012993037,1287668515012993038,1287668515012993039,1287668515012993040,1287668515012993041,1287668515012993042,1287668515012993043,1287668515012993044,1287668515012993045,1287668515012993046,1287668515012993047,1287668515012993048,1287668515012993049,1287668515012993050,1287668515012993051,1287668515012993052,1287668515012993053,1287668515012993054,1287668515012993055,1287668515012993056,1287668515012993057,1287668515012993058,1287668515012993059,1287668515012993060,1287668515012993061,1287668515012993062,1287668515012993063,1287668515012993064,1287668515012993065,1287668515012993066,1287668515012993067,1287668515012993068,1287668515012993069,1287668515012993070,1287668515012993071,1287668515012993072,1287668515012993073,1287668515012993074,1287668515012993075,1287668515012993076,1287668515012993077,1287668515012993078,1287668515021381633,1287668515021381634,1287668515021381635,1287668515021381636,1287668515021381637,1287668515021381638,1287668515021381639,1287668515021381640";


            reqDTO.setTradeOrderIds(tradeOrderIds);
            reqDTO.setAccount("9100001101000005636");
            reqDTO.setPayAmt("99");
            reqDTO.setRemark("20200415105418");

            builder.setReqData(reqDTO);

            log.info("单笔实时分账 请求报文:{}", JSON.toJSONString(builder.getReqData()));

            ServerResponse<SplitPaymentRespDTO> serverResponse = send(builder);

            if (serverResponse.getRespData() == null) {
                log.error("单笔实时分账异常：响应结果为null", serverResponse.getThrowable());
            } else {
                SplitPaymentRespDTO respDTO = serverResponse.getRespData();
                log.info("单笔实时分账 响应报文:{}", JSON.toJSONString(respDTO));
                HttpRespStatus httpRespStatus = HttpRespStatus.resolve(respDTO.getStatus());
                if (httpRespStatus.is2xxSuccessful()) {
                    log.info("单笔实时分账 成功");
                } else {
                    log.error("单笔实时分账失败：status[{}] {}", respDTO.getStatus(), respDTO.getMessage());
                }
            }
        } catch (Exception e) {
            log.error("单笔实时分账异常：{}", e.getMessage(), e);
        }
    }

    @Test
    public void batchDemo() {
        try {
            AccountClient client = new AccountClient(createAuthorization(AuthType.HTSIGN), host);


            AtomicInteger succNum = new AtomicInteger(0);
            AtomicInteger failNum = new AtomicInteger(0);
          CompletableFuture[] futures =  IntStream.range(1,1001).mapToObj(i-> CompletableFuture.supplyAsync(()->{
                AccountClient.Builder<SplitPaymentRespDTO> builder = client.newSplitPaymentBuilder();
              // 初始化requestBody
                SplitPaymentReqDTO reqDTO = new SplitPaymentReqDTO();
                reqDTO.setClientTradeId(mockClientTransId());
                reqDTO.setReqDate(LocalDate.now().format(DateTimeFormatter.ofPattern("yyyyMMdd")));
                reqDTO.setReqTime(LocalTime.now().format(DateTimeFormatter.ofPattern("HHmmss")));

                reqDTO.setTradeOrderIds("2020052114UTP1263353208630423574");
                reqDTO.setAccount("9100001101000002267");
                reqDTO.setPayAmt("1");
                reqDTO.setRemark("单笔分账当前第几笔"+i);
                builder.setReqData(reqDTO);

                log.info("流水号[{}] >> 单笔实时分账 请求报文:{}", reqDTO.getClientTradeId(),JSON.toJSONString(builder.getReqData()));

                ServerResponse<SplitPaymentRespDTO> serverResponse = new ServerResponse<>();
              try {
                  builder.execute().whenComplete(((splitPaymentRespDTO, throwable) -> {
                          if(throwable!=null){
                              serverResponse.setThrowable(throwable);
                          }
                          serverResponse.setRespData(splitPaymentRespDTO);
                  })).get(30, TimeUnit.SECONDS);
              } catch (InterruptedException e) {
                  e.printStackTrace();
              } catch (ExecutionException e) {
                  e.printStackTrace();
              } catch (TimeoutException e) {
                  e.printStackTrace();
              }
              if (serverResponse.getRespData() == null) {
                    log.error("流水号[{}] >> 单笔实时分账异常：响应结果为null", reqDTO.getClientTradeId(),serverResponse.getThrowable());
                    failNum.incrementAndGet();
                } else {
                    SplitPaymentRespDTO respDTO = serverResponse.getRespData();
                    log.info("流水号[{}] >> 单笔实时分账 响应报文:{}", reqDTO.getClientTradeId(),JSON.toJSONString(respDTO));
                    HttpRespStatus httpRespStatus = HttpRespStatus.resolve(respDTO.getStatus());
                    if (httpRespStatus.is2xxSuccessful()) {
                        log.info("流水号[{}] >> 单笔实时分账 成功",reqDTO.getClientTradeId());
                        succNum.incrementAndGet();
                    } else {
                        failNum.incrementAndGet();
                        log.error("流水号[{}] >> 单笔实时分账失败：status[{}] {}", reqDTO.getClientTradeId(),respDTO.getStatus(), respDTO.getMessage());
                    }
                }
                return serverResponse;
            })).toArray(CompletableFuture[]::new);

            CompletableFuture.allOf(futures).join();

            System.out.println("批量调用 单笔实时分账完成 = 成功笔数:"+succNum.get()+" 失败笔数:"+failNum.get());

        } catch (Exception e) {
            log.error("单笔实时分账异常：{}", e.getMessage(), e);
        }
    }



}
